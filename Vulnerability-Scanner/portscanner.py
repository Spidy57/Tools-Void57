import socket
from termcolor import colored

class Portscanner:
    def __init__(self):
        self.banners = {}

    def scan(self, target, ports):
        print('\n' + colored('[*] Starting Scan for ' + str(target), "cyan"))
        print(colored(f'{str(target)}', "green"))
        open_ports = 0
        self.banners = {}
        for port in range(1, ports + 1):
            if self.scan_port(target, port):
                open_ports += 1
        print(colored(f"\n[#] {target} - Open Ports : {open_ports} | Closed Ports : {ports - open_ports} (Out of {ports})", "light_magenta"))

    def scan_port(self, ipaddress, port):
        try:
            sock = socket.socket()
            sock.settimeout(1)
            sock.connect((ipaddress, port))
            try:
                banner = sock.recv(1024).decode(errors='ignore').strip()
                if not banner:
                    banner = "No Banner"
                else:
                    banner = banner.replace("+OK ", "").replace("* OK ", "").strip()
            except:
                banner = 'No Banner'
            self.banners[port] = banner
            print(colored(f"└─ [+] Open Port {port} - {banner}", "green"))
            sock.close()
            return True
        except:
            return False


print(colored("\n-------------------------------------------------------------------------------------------------------\n", "cyan"))
print(colored('''███████╗ ██████╗ █████╗ ███╗   ██╗    ████████╗██╗  ██╗███████╗    ██╗    ██╗███████╗ █████╗ ██╗  ██╗
██╔════╝██╔════╝██╔══██╗████╗  ██║    ╚══██╔══╝██║  ██║██╔════╝    ██║    ██║██╔════╝██╔══██╗██║ ██╔╝
███████╗██║     ███████║██╔██╗ ██║       ██║   ███████║█████╗      ██║ █╗ ██║█████╗  ███████║█████╔╝ 
╚════██║██║     ██╔══██║██║╚██╗██║       ██║   ██╔══██║██╔══╝      ██║███╗██║██╔══╝  ██╔══██║██╔═██╗ 
███████║╚██████╗██║  ██║██║ ╚████║       ██║   ██║  ██║███████╗    ╚███╔███╔╝███████╗██║  ██║██║  ██╗
╚══════╝ ╚═════╝╚═╝  ╚═╝╚═╝  ╚═══╝       ╚═╝   ╚═╝  ╚═╝╚══════╝     ╚══╝╚══╝ ╚══════╝╚═╝  ╚═╝╚═╝  ╚═╝\n
By Spidy57''', "light_magenta"))
print(colored("\n-------------------------------------------------------------------------------------------------------\n", "cyan"))

targets = input(colored("[?] Enter Targets To Scan(split them by ,): ", "yellow"))
ports = int(input(colored("\n[?] Enter How Many Ports You Want To Scan: ", "yellow")))

scanner = Portscanner()

if ',' in targets:
    print(colored("[*] Scanning Multiple Targets", "cyan"))
    for target in targets.split(','):
        scanner.scan(target.strip(), ports)
else:
    scanner.scan(targets.strip(), ports)
